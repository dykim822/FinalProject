<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="carpoolns">
<!-- 	<resultMap type="carpool" id="carpoolResult">
		<result property="CP_num" 			column="CP_num" />
		<result property="CP_regDate" 		column="CP_regDate" />
		<result property="CP_startPoint"	column="CP_startPoint" />
		<result property="CP_endPoint" 		column="CP_endPoint" />
		<result property="CP_startDate" 	column="CP_startDate" />
		<result property="CP_startTime" 	column="CP_startTime" />
		<result property="CP_fee" 			column="CP_fee" />
		<result property="CP_passNum" 		column="CP_passNum" />
		<result property="CP_gendertype" 	column="CP_gendertype" />
		<result property="CP_option" 		column="CP_option" />
		<result property="CP_duration" 		column="CP_duration" />
		<result property="CP_comment" 		column="CP_comment" />
		<result property="CP_del" 			column="CP_del" />
		<result property="MB_num" 			column="MB_num" />
		paging용
		<result property="startRow" column="startRow" />
		<result property="endRow" 	column="endRow" />
		검색용
		<result property="search" 	column="search" />
		<result property="keyword"	column="keyword" />
		join용 
		<collection property="member" resultMap="memberResult"></collection>
	</resultMap>
	<resultMap type="member" id="memberResult">
		<result property="MB_num"		column="MB_num"/>
		<result property="MB_id"		column="MB_id"/>
		<result property="MB_pw" 		column="MB_pw"/>
		<result property="MB_name" 		column="MB_name"/>
		<result property="MB_regNum" 	column="MB_regNum"/>
		<result property="MB_nickName" 	column="MB_nickName"/>
		<result property="MB_tel" 		column="MB_tel"/>
		<result property="MB_gender" 	column="MB_gender"/>
		<result property="MB_regDate" 	column="MB_regDate"/>
		<result property="MB_car" 		column="MB_car"/>
		<result property="MB_driverConfirm" 	column="MB_driverConfirm"/>
		<result property="MB_del" 		column="MB_del"/>
		<result property="MB_img" 		column="MB_img"/>
	</resultMap> -->
	
	<insert id="insert" parameterType="carpool">
		insert into CARPOOL
		(CP_num,CP_regDate,CP_startPoint,CP_endPoint,CP_startDate,CP_startTime,CP_fee,
		CP_passNum,CP_gendertype,CP_option,CP_duration,CP_comment,CP_del,MB_num)
		values(#{CP_num},sysdate, #{CP_startPoint}, #{CP_endPoint}, #{CP_startDate}, #{CP_startTime}, #{CP_fee}, #{CP_passNum},
		#{CP_gendertype},#{CP_option},#{CP_duration},#{CP_comment},'N',#{MB_num})
	</insert>
	
	<select id="carpoolList" parameterType="carpool" resultType="carpool">
		select * from (select a.*, rowNum rn from (select * from carpool
		<!-- 검색 기능 사용시 -->
		<!-- keyword에 값이 있으면 where속에 like옵션 사용, 없으면 사용X -->
		<!-- ${}는 변수, #{}는 값 -->
		<where>
			<!-- 검색어가 있을때 -->
			<if test="keyword!=null and keyword!=''">
				${search} like '%'||#{keyword}||'%'
			</if>
		</where>
		order by CP_num desc) a) where rn between #{startRow} and #{endRow}
	</select>
	
	<select id="getTotal" parameterType="carpool" resultType="integer">
		select count(*) from carpool
		<!-- 페이징  숫자 버튼 검색화면에 맞게 설정하기 -->
		<where>
			<if test="keyword!=null and keyword!=''">
				${search} like '%'||#{keyword}||'%'
			</if>
		</where>
	</select>
	
	<select id="getMaxNum" resultType="integer">
		select nvl(max(CP_num),0) + 1 from carpool
	</select>
	
	<select id="select" parameterType="integer" resultType="carpool">
		select * from carpool where CP_num=#{CP_num}
	</select>
	
	<update id="update" parameterType="carpool">
		update carpool set CP_startPoint=#{CP_startPoint}, CP_endPoint=#{CP_endPoint}, CP_startDate=#{CP_startDate}, CP_startTime=#{CP_startTime}, CP_fee=#{CP_fee}, CP_passNum=#{CP_passNum},
		CP_gendertype=#{CP_gendertype},CP_option=#{CP_option},CP_duration=#{CP_duration},CP_comment=#{CP_comment} where CP_num=#{CP_num}
	</update>
	
	<update id="delete" parameterType="integer">
		update carpool set CP_del='Y' where CP_num=#{CP_num}
	</update>
	
	
</mapper>